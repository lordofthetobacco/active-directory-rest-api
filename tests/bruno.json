{
  "version": "1",
  "name": "Active Directory API Tests",
  "type": "collection",
  "ignore": [
    "node_modules",
    ".git"
  ],
  "docs": [
    {
      "name": "README",
      "content": "# Active Directory API Test Collection\n\nThis collection tests all endpoints of the Active Directory API including:\n- User management (CRUD operations)\n- Group management\n- User authentication\n- User search and filtering\n- Group membership operations\n- User state management (enable/disable/delete)\n- Security operations (password reset, unlock)\n\n## Test Flow\n\nThe tests are designed to run in sequence and test the complete user lifecycle:\n1. Create a test user\n2. Test user retrieval and search\n3. Test group operations\n4. Test user state changes\n5. Test security operations\n6. Clean up by deleting the test user\n\n## Environment Variables\n\nSet these in your Bruno environment:\n- `baseUrl`: Your API base URL (e.g., https://localhost:7001)\n- `testUsername`: A test username (e.g., testuser123)\n- `testEmail`: A test email (e.g., testuser123@yourdomain.com)\n- `testGroup`: A test group name (e.g., TestGroup123)\n- `testPassword`: A test password\n- `testUPN`: A test User Principal Name (e.g., testuser123@yourdomain.com)"
    }
  ],
  "environments": [
    {
      "name": "Development",
      "data": {
        "baseUrl": "https://localhost:7001",
        "testUsername": "testuser123",
        "testEmail": "testuser123@yourdomain.com",
        "testGroup": "TestGroup123",
        "testPassword": "TestPassword123!",
        "testUPN": "testuser123@yourdomain.com",
        "testDN": "CN=testuser123,CN=Users,DC=yourdomain,DC=com"
      }
    }
  ],
  "folders": [
    {
      "name": "Health Check",
      "items": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/health",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": "Healthy"
          }
        }
      ]
    },
    {
      "name": "User Management",
      "items": [
        {
          "name": "Create User",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"samAccountName\": \"{{testUsername}}\",\n  \"email\": \"{{testEmail}}\",\n  \"firstName\": \"Test\",\n  \"lastName\": \"User\",\n  \"password\": \"{{testPassword}}\"\n}"
            }
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Get User by SAM Account Name",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/{{testUsername}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}",
              "firstName": "Test",
              "lastName": "User",
              "displayName": "Test User",
              "manager": "",
              "memberOf": [],
              "whenCreated": "",
              "whenChanged": ""
            }
          }
        },
        {
          "name": "Get User with Specific Properties",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/properties?properties=samAccountName&properties=email&properties=firstName",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}",
              "firstName": "Test"
            }
          }
        },
        {
          "name": "Get User by Email",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/email/{{testEmail}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}"
            }
          }
        },
        {
          "name": "Get User by Email with Properties",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/email/{{testEmail}}/properties?properties=samAccountName&properties=email&properties=lastName",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}",
              "lastName": "User"
            }
          }
        },
        {
          "name": "Get User by Distinguished Name",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/dn/{{testDN}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}"
            }
          }
        },
        {
          "name": "Get User by DN with Properties",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/dn/{{testDN}}/properties?properties=samAccountName&properties=email&properties=displayName",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "samAccountName": "{{testUsername}}",
              "email": "{{testEmail}}",
              "displayName": "Test User"
            }
          }
        },
        {
          "name": "Update User",
          "request": {
            "method": "PUT",
            "url": "{{baseUrl}}/api/users/{{testUsername}}",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"samAccountName\": \"{{testUsername}}\",\n  \"email\": \"{{testEmail}}\",\n  \"firstName\": \"Updated\",\n  \"lastName\": \"User\",\n  \"displayName\": \"Updated User\",\n  \"title\": \"Software Developer\",\n  \"department\": \"IT\"\n}"
            }
          },
          "response": {
            "status": 200,
            "body": true
          }
        }
      ]
    },
    {
      "name": "User Search",
      "items": [
        {
          "name": "Search Users by Full Name",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/search/fullname?q=Test&maxResults=10",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": [
              {
                "samAccountName": "{{testUsername}}",
                "email": "{{testEmail}}",
                "firstName": "Updated",
                "lastName": "User",
                "displayName": "Updated User"
              }
            ]
          }
        },
        {
          "name": "Search Users by UPN",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/search/upn?q=testuser&maxResults=10",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": [
              {
                "samAccountName": "{{testUsername}}",
                "email": "{{testEmail}}",
                "userPrincipalName": "{{testUPN}}"
              }
            ]
          }
        },
        {
          "name": "Advanced User Search",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/search",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"searchTerm\": \"Test\",\n  \"maxResults\": 10,\n  \"includeDisabled\": false\n}"
            }
          },
          "response": {
            "status": 200,
            "body": [
              {
                "samAccountName": "{{testUsername}}",
                "email": "{{testEmail}}",
                "firstName": "Updated",
                "lastName": "User"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "User Authentication",
      "items": [
        {
          "name": "Authenticate User",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/authenticate",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"username\": \"{{testUsername}}\",\n  \"password\": \"{{testPassword}}\"\n}"
            }
          },
          "response": {
            "status": 200,
            "body": true
          }
        }
      ]
    },
    {
      "name": "User Extension Attributes",
      "items": [
        {
          "name": "Get User Extension Attributes",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/extension-attributes",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "extensionAttribute1": "value1",
              "extensionAttribute2": "value2"
            }
          }
        },
        {
          "name": "Get User Extension Attributes by UPN",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}/extension-attributes",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "extensionAttribute1": "value1",
              "extensionAttribute2": "value2"
            }
          }
        }
      ]
    },
    {
      "name": "Group Management",
      "items": [
        {
          "name": "Get Group",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": {
              "name": "{{testGroup}}",
              "samAccountName": "{{testGroup}}",
              "description": "Test group for API testing",
              "members": [],
              "memberOf": [],
              "manager": "",
              "whenCreated": "",
              "whenChanged": ""
            }
          }
        },
        {
          "name": "Search Groups by Name",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/search/name?q=Test&maxResults=10",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": [
              {
                "name": "{{testGroup}}",
                "samAccountName": "{{testGroup}}",
                "description": "Test group for API testing"
              }
            ]
          }
        },
        {
          "name": "Advanced Group Search",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/groups/search",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"searchTerm\": \"Test\",\n  \"maxResults\": 10\n}"
            }
          },
          "response": {
            "status": 200,
            "body": [
              {
                "name": "{{testGroup}}",
                "samAccountName": "{{testGroup}}",
                "description": "Test group for API testing"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "Group Membership Operations",
      "items": [
        {
          "name": "Check if User is in Group",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}/members/{{testUsername}}/check",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": false
          }
        },
        {
          "name": "Add User to Group",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}/members/{{testUsername}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Verify User Added to Group",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}/members/{{testUsername}}/check",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Get User Groups",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/groups",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": [
              "{{testGroup}}"
            ]
          }
        },
        {
          "name": "Remove User from Group",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}/members/{{testUsername}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Verify User Removed from Group",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/{{testGroup}}/members/{{testUsername}}/check",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": false
          }
        }
      ]
    },
    {
      "name": "User State Management",
      "items": [
        {
          "name": "Disable User",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/disable",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Disable User by UPN",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}/disable",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Enable User",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/enable",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Enable User by UPN",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}/enable",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        }
      ]
    },
    {
      "name": "User Security Operations",
      "items": [
        {
          "name": "Reset User Password",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/reset-password",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"newPassword\": \"NewPassword123!\"\n}"
            }
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Reset User Password by UPN",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}/reset-password",
            "headers": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "json",
              "raw": "{\n  \"newPassword\": \"NewPassword123!\"\n}"
            }
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Unlock User",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/{{testUsername}}/unlock",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Unlock User by UPN",
          "request": {
            "method": "POST",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}/unlock",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        }
      ]
    },
    {
      "name": "User Cleanup",
      "items": [
        {
          "name": "Delete User",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/api/users/{{testUsername}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        },
        {
          "name": "Delete User by UPN",
          "request": {
            "method": "DELETE",
            "url": "{{baseUrl}}/api/users/upn/{{testUPN}}",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 200,
            "body": true
          }
        }
      ]
    },
    {
      "name": "Error Handling Tests",
      "items": [
        {
          "name": "Get Non-existent User",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/nonexistentuser",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 404
          }
        },
        {
          "name": "Get Non-existent Group",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/groups/nonexistentgroup",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 404
          }
        },
        {
          "name": "Search with Empty Query",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/search/fullname?q=&maxResults=10",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 400
          }
        },
        {
          "name": "Invalid Max Results",
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/api/users/search/fullname?q=test&maxResults=150",
            "headers": [],
            "body": {}
          },
          "response": {
            "status": 400
          }
        }
      ]
    }
  ]
}